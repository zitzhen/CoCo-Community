name: Sync to Gitee

on:
  push:
    branches:
      - main  # ç›‘å¬ main åˆ†æ”¯æ¨é€äº‹ä»¶

jobs:
  sync:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout GitHub repo
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # è·å–å®Œæ•´å†å²ï¼Œä¾¿äºé•œåƒæ¨é€

      - name: Prepare variables
        run: |
          echo "ğŸ§© æ£€æŸ¥ç¯å¢ƒå˜é‡..."
          echo "GitHub repo: ${{ github.repository }}"
          echo "Gitee target: https://gitee.com/${GITEE_ORG}/${GITEE_REPO}.git"
          echo "ç”¨æˆ·å: ${GITEE_USERNAME}"
          if [ -z "${GITEE_TOKEN}" ]; then
            echo "âŒ GITEE_TOKEN æœªè®¾ç½®"; exit 1;
          fi

      - name: Mirror push to Gitee
        run: |
          set -e
          echo "ğŸš€ å…‹éš†æºä»“åº“..."
          git clone --mirror "https://github.com/${{ github.repository }}" repo
          cd repo

          echo "ğŸ”— æ·»åŠ  Gitee è¿œç¨‹ä»“åº“..."
          git remote remove gitee 2>/dev/null || true
          git remote add gitee "https://${GITEE_USERNAME}:${GITEE_TOKEN}@gitee.com/${GITEE_ORG}/${GITEE_REPO}.git"

          echo "âœ… éªŒè¯è¿œç¨‹ï¼š"
          git remote -v

          echo "â¬†ï¸ å¼€å§‹æ¨é€åˆ° Gitee..."
          git push gitee --mirror || { echo "âŒ æ¨é€å¤±è´¥"; exit 1; }

          echo "ğŸ‰ æ¨é€å®Œæˆï¼"
        env:
          GITEE_USERNAME: hello-oliver          # ä½ çš„ Gitee ç”¨æˆ·åï¼ˆä¸ªäººè´¦å·ï¼‰
          GITEE_ORG: zitzhen                    # Gitee ç»„ç»‡å
          GITEE_REPO: CoCo-Community            # ä»“åº“å
          GITEE_TOKEN: ${{ secrets.GITEE_TOKEN }} # Personal Access Token